<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pi æ•°å­—éªŒè¯</title>
    <style>
        body {
            background-color: #0a192f;
            color: #ccd6f6;
            margin: 0;
            padding: 20px;
            font-family: 'Arial', sans-serif;
        }

        h1 {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .container {
            max-width: 100%;
            width: 100%;
            margin: 0 auto;
        }

        .input-group {
            margin-bottom: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
        }

        #piPrecision {
            background-color: transparent;
            border: 1px solid #64ffda;
            color: #ccd6f6;
            padding: 0.5rem;
            width: 120px;
        }

        #piPrecision:focus {
            outline: none;
            border-color: #007bff;
        }

        .input-box {
            display: flex;
            align-items: flex-start;
            gap: 8px;
            width: 100%;
            margin: 1rem 0;
        }

        .pi-prefix {
            font-size: 1rem;
            color: #ccd6f6;
            line-height: 1.5;
            padding-top: 0.5rem;
        }

        #piInput {
            flex: 1;
            background-color: transparent;
            border: 1px solid #64ffda;
            color: #ccd6f6;
            padding: 0.5rem;
            resize: none;
            overflow-y: hidden;
            font-family: monospace;
            min-height: 40px;
        }

        #piInput:focus {
            outline: none;
            border-color: #007bff;
        }

        .progress-container {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
            color: #64ffda;
        }

        #errorCount {
            color: #ff4d4f;
            margin: 1rem 0;
        }

        button {
            background-color: #64ffda;
            color: #0a192f;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #007bff;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: #112240;
            border: 1px solid #64ffda;
            padding: 2rem;
            border-radius: 4px;
            animation: fadeIn 0.3s ease-in;
            color: #ccd6f6;
            text-align: center;
            z-index: 1000;
        }

        .modal.show {
            display: block;
        }

        .digit-display {
            font-size: 3rem;
            font-weight: bold;
            margin: 1rem 0;
        }

        .error-digit {
            color: #ff4d4f;
        }

        .correct-digit {
            color: #64ffda;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .success-modal {
            animation: pulse 0.5s ease-in-out;
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                transform: translate(-50%, -50%) scale(1.05);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        /* æ–°å¢æ ·å¼ */
        .nickname-container {
            margin-bottom: 2rem;
        }

        #nicknameInput {
            background-color: transparent;
            border: 1px solid #64ffda;
            color: #ccd6f6;
            padding: 0.5rem;
            margin-right: 1rem;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #64ffda;
            animation: confetti 3s ease-out forwards;
        }

        @keyframes confetti {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
            }

            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .completed-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
        }

        /* æ–°å¢è­¦å‘Šå¼¹çª—æ ·å¼ */
        .warning-modal {
            background-color: #ffd700;
            color: #000;
            border: 3px solid #ff8c00;
            text-align: center;
            padding: 20px;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .warning-icon {
            font-size: 3rem;
            margin-bottom: 10px;
            color: #ff8c00;
        }

        /* èƒœåˆ©å¼¹çª—æ ·å¼ */
        .victory-modal {
            width: 80%;
            max-width: 500px;
            text-align: center;
        }

        .medal {
            width: 150px;
            height: 150px;
            background-color: gold;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 80px;
            color: #0a192f;
            border: 5px solid #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            animation: shine 2s infinite alternate;
        }

        @keyframes shine {
            from {
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.7);
            }
            to {
                box-shadow: 0 0 30px rgba(255, 215, 0, 1);
            }
        }

        .victory-text {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #64ffda;
        }

        .close-btn {
            margin-top: 20px;
        }

        /* èƒœåˆ©è€…åå•æ ·å¼ */
        .winners-list-container {
            margin-top: 40px;
            border-top: 1px solid #64ffda;
            padding-top: 20px;
        }

        .winners-list-title {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: #64ffda;
            text-align: center;
        }

        .winners-table {
            width: 100%;
            border-collapse: collapse;
            margin: 0 auto;
            background-color: rgba(17, 34, 64, 0.5);
        }

        .winners-table th, 
        .winners-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #233554;
        }

        .winners-table th {
            background-color: #112240;
            color: #64ffda;
        }

        .winners-table tr:hover {
            background-color: #233554;
        }

        .no-winners {
            text-align: center;
            padding: 20px;
            color: #8892b0;
            font-style: italic;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="nickname-container">
            <input type="text" id="nicknameInput" placeholder="è¾“å…¥æ˜µç§°">
            <button onclick="setNickname()" id="confirmNickname">ç¡®è®¤æ˜µç§°</button>
            <button onclick="logout()" id="logoutBtn" style="display: none;">é€€å‡º</button>
        </div>


        <h1>Pi æ•°å­—éªŒè¯</h1>
        <div id="errorCount">é”™è¯¯æ¬¡æ•°: 0</div>

        <div class="input-group">
            <label for="piPrecision">Ï€ ç²¾åº¦ï¼ˆæœ€å¤§æ ¡éªŒä½æ•°ï¼‰:</label>
            <input type="number" id="piPrecision" min="1" value="1000" disabled>
        </div>

        <div class="progress-container">
            <div id="currentDigits">å½“å‰è¾“å…¥: 0 ä½</div>
            <div id="totalProgress">è¿›åº¦: 0/1000</div>
        </div>

        <div class="input-box">
            <span class="pi-prefix">3.</span>
            <textarea id="piInput" placeholder="è¾“å…¥Ï€çš„å°æ•°éƒ¨åˆ†..."></textarea>
        </div>

        <button onclick="handleRefresh()">åˆ·æ–°</button>
    </div>

    <div id="errorModal" class="modal">
        <p>è¾“å…¥é”™è¯¯ï¼</p>
        <div class="digit-display error-digit" id="errorDigitDisplay"></div>
        <p>ä¸æ˜¯Ï€çš„æ­£ç¡®æ•°å­—</p>
    </div>

    <div id="correctModal" class="modal success-modal">
        <p>è¾“å…¥æ­£ç¡®ï¼</p>
        <div class="digit-display correct-digit" id="correctDigitDisplay"></div>
        <p>æ˜¯Ï€çš„ç¬¬<span id="digitPosition">0</span>ä½æ•°å­—</p>
    </div>

    <!-- è­¦å‘Šå¼¹çª— -->
    <div id="pasteWarningModal" class="modal warning-modal">
        <div class="warning-icon">âš ï¸</div>
        <p>ç¦æ­¢ç²˜è´´ï¼è¯·æ‰‹åŠ¨è¾“å…¥æ•°å­—ã€‚</p>
        <button onclick="closePasteWarning()">æˆ‘çŸ¥é“äº†</button>
    </div>

    <!-- èƒœåˆ©å¼¹çª— -->
    <div id="victoryModal" class="modal victory-modal">
        <div class="medal">ğŸ†</div>
        <div class="victory-text">æ­å–œ <span id="winnerName"></span> è·å¾—èƒœåˆ©ï¼</div>
        <button class="close-btn" onclick="closeVictoryModal()">å…³é—­</button>
    </div>

    <!-- æ–°å¢ä¸€ä¸ªæŒ‰é’®æ¥æ‰‹åŠ¨åˆ·æ–°èƒœåˆ©è€…åå• -->
    <button onclick="refreshWinnersList()" style="margin-top: 20px;">åˆ·æ–°èƒœåˆ©è€…åå•</button>

    <!-- èƒœåˆ©è€…åå• -->
    <div class="winners-list-container">
        <h2 class="winners-list-title">ğŸ† èƒœåˆ©è€…åå• ğŸ†</h2>
        <table class="winners-table" id="winnersTable">
            <thead>
                <tr>
                    <th>æ˜µç§°</th>
                    <th>èƒœåˆ©æ—¶é—´</th>
                    <th>é”™è¯¯æ¬¡æ•°</th>
                </tr>
            </thead>
            <tbody id="winnersTableBody">
                <!-- èƒœåˆ©è€…æ•°æ®å°†åœ¨è¿™é‡ŒåŠ¨æ€æ’å…¥ -->
            </tbody>
        </table>
    </div>

    <!-- éŸ³é¢‘å…ƒç´  -->
    <audio id="correctSound" src="./correct.wav" preload="auto"></audio>
    <audio id="wrongSound" src="./wrong.wav" preload="auto"></audio>
    <audio id="keySound" src="./press.wav" preload="auto"></audio>

    <!-- æ–°å¢å®ŒæˆåŠ¨ç”»å®¹å™¨ -->
    <div id="completedAnimation" class="completed-animation"></div>

    <!-- æ–°å¢éŸ³é¢‘ -->
    <audio id="victorySound" src="./victor.wav" loop></audio>

    <script>
        let piDigits = '';
        let errorCount = parseInt(localStorage.getItem('piErrorCount')) || 0;
        let nickname = localStorage.getItem('piNickname');
        let timeoutId;
        const errorCountElement = document.getElementById('errorCount');
        const piInput = document.getElementById('piInput');
        const piPrecisionInput = document.getElementById('piPrecision');
        const errorModal = document.getElementById('errorModal');
        const correctModal = document.getElementById('correctModal');
        const currentDigitsElement = document.getElementById('currentDigits');
        const totalProgressElement = document.getElementById('totalProgress');
        const errorDigitDisplay = document.getElementById('errorDigitDisplay');
        const correctDigitDisplay = document.getElementById('correctDigitDisplay');
        const digitPositionElement = document.getElementById('digitPosition');
        const pasteWarningModal = document.getElementById('pasteWarningModal');
        const victoryModal = document.getElementById('victoryModal');
        const winnerNameElement = document.getElementById('winnerName');
        let isVictory = false;
        // ä»localStorageåŠ è½½èƒœåˆ©è€…åˆ—è¡¨
        let winnersList = JSON.parse(localStorage.getItem('piWinnersList')) || [];

        // éŸ³é¢‘å…ƒç´ 
        const correctSound = document.getElementById('correctSound');
        const wrongSound = document.getElementById('wrongSound');
        const keySound = document.getElementById('keySound');

        // é¢„å…ˆç”Ÿæˆçš„Ï€å°æ•°ä½ï¼ˆç¤ºä¾‹å‰1000ä½ï¼‰
        const precomputedPi = '1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989';

        // åˆå§‹åŒ–ç•Œé¢
        function init() {
            if (nickname) {
                document.getElementById('nicknameInput').value = nickname;
                document.getElementById('nicknameInput').disabled = true;
                document.getElementById('confirmNickname').style.display = 'none';
                document.getElementById('logoutBtn').style.display = 'inline';
                // å¯ç”¨è¾“å…¥æ¡†
                piInput.disabled = false;
            } else {
                // å¦‚æœæ²¡æœ‰æ˜µç§°ï¼Œç¦ç”¨è¾“å…¥æ¡†
                piInput.disabled = true;
                piInput.placeholder = "è¯·å…ˆè¾“å…¥æ˜µç§°...";
            }
            errorCountElement.textContent = `é”™è¯¯æ¬¡æ•°: ${errorCount}`;
            initPiDigits();
        }

        // è®¾ç½®æ˜µç§°
        function setNickname() {
            const input = document.getElementById('nicknameInput');
            if (!input.value.trim()) {
                alert('è¯·è¾“å…¥æ˜µç§°');
                return;
            }
            nickname = input.value.trim();
            localStorage.setItem('piNickname', nickname);
            input.disabled = true;
            document.getElementById('confirmNickname').style.display = 'none';
            document.getElementById('logoutBtn').style.display = 'inline';
            
            // å¯ç”¨è¾“å…¥æ¡†
            piInput.disabled = false;
            piInput.placeholder = "è¾“å…¥Ï€çš„å°æ•°éƒ¨åˆ†...";
            piInput.focus();
        }

        // é€€å‡ºç™»å½•
        function logout() {
            localStorage.removeItem('piNickname');
            localStorage.removeItem('piErrorCount');
            nickname = null;
            errorCount = 0;
            document.getElementById('nicknameInput').value = '';
            document.getElementById('nicknameInput').disabled = false;
            document.getElementById('confirmNickname').style.display = 'inline';
            document.getElementById('logoutBtn').style.display = 'none';
            piInput.disabled = true;
            piInput.placeholder = "è¯·å…ˆè¾“å…¥æ˜µç§°...";
            piInput.value = '';
            errorCountElement.textContent = `é”™è¯¯æ¬¡æ•°: 0`;
            initPiDigits();
            
            // å¦‚æœæœ‰èƒœåˆ©çŠ¶æ€ï¼Œé‡ç½®å®ƒ
            if (isVictory) {
                isVictory = false;
                const victorySound = document.getElementById('victorySound');
                victorySound.pause();
                victorySound.currentTime = 0;
                document.getElementById('completedAnimation').innerHTML = '';
                victoryModal.classList.remove('show');
            }
        }

        // å®ŒæˆåŠ¨ç”»
        function playCompleteAnimation() {
            isVictory = true;
            const container = document.getElementById('completedAnimation');
            const colors = ['#64ffda', '#ff4d4f', '#007bff'];

            // åˆ›å»ºç¤¼èŠ±
            for (let i = 0; i < 100; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(confetti);
            }

            // æ’­æ”¾éŸ³æ•ˆå¹¶è®¾ç½®å¾ªç¯
            const victorySound = document.getElementById('victorySound');
            victorySound.loop = true;
            victorySound.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:", e));
            
            // æ¯éš”4.5ç§’åˆ·æ–°ä¸€æ¬¡ç¤¼èŠ±æ•ˆæœï¼Œä¿æŒåŠ¨ç”»æŒç»­
            const refreshAnimation = () => {
                if (isVictory) {
                    container.innerHTML = '';
                    for (let i = 0; i < 100; i++) {
                        const confetti = document.createElement('div');
                        confetti.className = 'confetti';
                        confetti.style.left = Math.random() * 100 + 'vw';
                        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                        confetti.style.animationDelay = Math.random() * 2 + 's';
                        container.appendChild(confetti);
                    }
                    setTimeout(refreshAnimation, 4500);
                }
            };
            
            setTimeout(refreshAnimation, 4500);
            
            // æ˜¾ç¤ºèƒœåˆ©å¼¹çª—
            winnerNameElement.textContent = nickname || "ç©å®¶";
            victoryModal.classList.add('show');
            
            // è®°å½•èƒœåˆ©è€…ä¿¡æ¯
            const currentTime = new Date();
            const formattedTime = `${currentTime.getFullYear()}-${padZero(currentTime.getMonth() + 1)}-${padZero(currentTime.getDate())} ${padZero(currentTime.getHours())}:${padZero(currentTime.getMinutes())}:${padZero(currentTime.getSeconds())}`;
            
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç»åœ¨åå•ä¸­
            const existingWinnerIndex = winnersList.findIndex(winner => winner.nickname === nickname);
            
            if (existingWinnerIndex >= 0) {
                // æ›´æ–°ç°æœ‰è®°å½•
                winnersList[existingWinnerIndex] = {
                    nickname: nickname,
                    time: formattedTime,
                    errors: errorCount
                };
            } else {
                // æ·»åŠ æ–°è®°å½•
                winnersList.push({
                    nickname: nickname,
                    time: formattedTime,
                    errors: errorCount
                });
            }
            
            // ä¿å­˜åˆ°localStorage
            localStorage.setItem('piWinnersList', JSON.stringify(winnersList));
            
            // æ›´æ–°èƒœåˆ©è€…åå•
            updateWinnersList();
        }
        
        // å·¥å…·å‡½æ•°ï¼šæ•°å­—è¡¥é›¶
        function padZero(num) {
            return num < 10 ? '0' + num : num;
        }
        
        // æ›´æ–°èƒœåˆ©è€…åå•
        function updateWinnersList() {
            const tableBody = document.getElementById('winnersTableBody');
            tableBody.innerHTML = '';
            
            if (winnersList.length === 0) {
                const row = document.createElement('tr');
                const cell = document.createElement('td');
                cell.colSpan = 3;
                cell.className = 'no-winners';
                cell.textContent = 'æš‚æ— èƒœåˆ©è€…è®°å½•';
                row.appendChild(cell);
                tableBody.appendChild(row);
                return;
            }
            
            // æŒ‰æ—¶é—´å€’åºæ’åˆ—
            const sortedWinners = [...winnersList].sort((a, b) => {
                return new Date(b.time) - new Date(a.time);
            });
            
            sortedWinners.forEach(winner => {
                const row = document.createElement('tr');
                
                const nameCell = document.createElement('td');
                nameCell.textContent = winner.nickname;
                
                const timeCell = document.createElement('td');
                timeCell.textContent = winner.time;
                
                const errorsCell = document.createElement('td');
                errorsCell.textContent = winner.errors;
                
                row.appendChild(nameCell);
                row.appendChild(timeCell);
                row.appendChild(errorsCell);
                
                tableBody.appendChild(row);
            });
        }
        
        // åˆ·æ–°èƒœåˆ©è€…åå•
        function refreshWinnersList() {
            winnersList = JSON.parse(localStorage.getItem('piWinnersList')) || [];
            updateWinnersList();
        }

        function generatePiDigits(n) {
            return precomputedPi.substring(0, n);
        }

        function initPiDigits() {
            const precision = parseInt(piPrecisionInput.value) || 1000;
            piDigits = generatePiDigits(precision);
            updateProgress(0);
        }
        initPiDigits();

        function updateProgress(currentLength) {
            currentDigitsElement.textContent = `å½“å‰è¾“å…¥: ${currentLength} ä½`;
            const totalDigits = Math.min(1000, parseInt(piPrecisionInput.value) || 1000);
            totalProgressElement.textContent = `è¿›åº¦: ${currentLength}/${totalDigits}`;
        }

        function playSound(sound) {
            sound.currentTime = 0;
            sound.play().catch(e => console.log("éŸ³é¢‘æ’­æ”¾è¢«é˜»æ­¢:", e));
        }

        function showCorrectDigit(digit, position) {
            correctDigitDisplay.textContent = digit;
            digitPositionElement.textContent = position;
            correctModal.classList.add('show');
            playSound(correctSound);
            setTimeout(() => {
                correctModal.classList.remove('show');
            }, 1000);
        }

        piInput.addEventListener('input', function (e) {
            // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²è¾“å…¥æ˜µç§°
            if (!nickname) {
                e.target.value = '';
                piInput.placeholder = "è¯·å…ˆè¾“å…¥æ˜µç§°...";
                return;
            }
            
            let value = e.target.value.replace(/[^0-9]/g, '');
            const maxLength = Math.min(1000, parseInt(piPrecisionInput.value) || 1000);
            value = value.slice(0, maxLength);

            // æ’­æ”¾æŒ‰é”®éŸ³æ•ˆï¼ˆä»…åœ¨æ–°å¢å­—ç¬¦æ—¶ï¼‰
            if (value.length > e.target.value.length) {
                playSound(keySound);
            }

            let correctLength = 0;
            let lastCorrectDigit = '';
            let lastCorrectPosition = 0;

            for (let i = 0; i < value.length; i++) {
                if (i >= piDigits.length) break;
                if (value[i] === piDigits[i]) {
                    correctLength++;
                    lastCorrectDigit = value[i];
                    lastCorrectPosition = i + 1; // åŠ 1å› ä¸ºÏ€çš„å°æ•°ç‚¹åç¬¬ä¸€ä½æ˜¯ä½ç½®1
                } else {
                    // å‘ç°é”™è¯¯æ—¶ä¿å­˜é”™è¯¯çš„æ•°å­—
                    const wrongDigit = value[i];
                    if (wrongDigit) {
                        errorDigitDisplay.textContent = wrongDigit;
                    }
                    break;
                }
            }

            if (correctLength < value.length) {
                value = value.slice(0, correctLength);
                e.target.value = value;
                handleError();
            } else {
                e.target.value = value;
                // å¦‚æœæœ‰æ–°è¾“å…¥çš„æ­£ç¡®æ•°å­—ï¼Œæ˜¾ç¤ºå®ƒ
                if (value.length > 0 && lastCorrectDigit && lastCorrectPosition === value.length) {
                    showCorrectDigit(lastCorrectDigit, lastCorrectPosition);
                }
            }

            updateProgress(value.length);
            adjustTextareaHeight(e.target);
            // ä¼˜åŒ–å¼¹çª—æ˜¾ç¤º
            clearTimeout(timeoutId);
            if (correctLength < value.length) {
                handleError();
            }

            // å®Œæˆæ£€æµ‹
            if (value.length === parseInt(piPrecisionInput.value)) {
                playCompleteAnimation();
            }
        });

        function handleError() {
            // æ¸…é™¤ä¹‹å‰çš„å¼¹çª—
            clearTimeout(timeoutId);
            errorModal.classList.remove('show');

            // æ˜¾ç¤ºæ–°å¼¹çª—
            errorModal.classList.add('show');
            timeoutId = setTimeout(() => {
                errorModal.classList.remove('show');
            }, 3000);

            // å…¶ä»–é”™è¯¯å¤„ç†é€»è¾‘ä¿æŒä¸å˜...
            piInput.disabled = true;
            errorCount++;
            localStorage.setItem('piErrorCount', errorCount.toString());
            errorCountElement.textContent = `é”™è¯¯æ¬¡æ•°: ${errorCount}`;

            errorModal.classList.add('show');
            playSound(wrongSound);
            setTimeout(() => {
                errorModal.classList.remove('show');
            }, 3000);
        }

        function adjustTextareaHeight(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = textarea.scrollHeight + 'px';
        }

        function handleRefresh() {
            initPiDigits();
            piInput.value = '';
            
            // åªæœ‰åœ¨æœ‰æ˜µç§°çš„æƒ…å†µä¸‹æ‰å¯ç”¨è¾“å…¥æ¡†
            if (nickname) {
                piInput.disabled = false;
            } else {
                piInput.disabled = true;
                piInput.placeholder = "è¯·å…ˆè¾“å…¥æ˜µç§°...";
            }
            
            adjustTextareaHeight(piInput);
            playSound(keySound); // åˆ·æ–°æ—¶ä¹Ÿæ’­æ”¾éŸ³æ•ˆ
            
            // é‡ç½®èƒœåˆ©çŠ¶æ€
            isVictory = false;
            const victorySound = document.getElementById('victorySound');
            victorySound.pause();
            victorySound.currentTime = 0;
            document.getElementById('completedAnimation').innerHTML = '';
        }

        errorCountElement.textContent = `é”™è¯¯æ¬¡æ•°: ${errorCount}`;

        // ç¦æ­¢ç²˜è´´åŠŸèƒ½
        piInput.addEventListener('paste', function(e) {
            playSound(wrongSound);
            e.preventDefault();
            pasteWarningModal.classList.add('show');
        });
        
        function closePasteWarning() {
            pasteWarningModal.classList.remove('show');
        }
        
        function closeVictoryModal() {
            victoryModal.classList.remove('show');
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶è°ƒç”¨åˆå§‹åŒ–å‡½æ•°
        init();
        // åˆå§‹åŒ–èƒœåˆ©è€…åå•
        updateWinnersList();
    </script>
</body>

</html>